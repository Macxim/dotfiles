#!/bin/zsh
source $DIR_DOTFILES/backpack/functions.sh

if ! type "brew" > /dev/null
then
  echo_title_install "Homebrew (brew)"
  ruby -e "$(curl -fsSL https://raw.github.com/mxcl/homebrew/go/install)"
  brew doctor
  # note: brew install run
  # xcode-select --install
  # yeah this is cool
else
  echo_title "Homebrew (brew) already installed"
fi

source brewu

brewtap homebrew/dupes
brewtap josegonzalez/homebrew-php

echo_title_install "brew packages"

PACKAGES=(
  # dyndns client updater
  ddclient

  zsh-completions

  # essential missing commands to OSX
  tree
  ssh-copy-id

  git
  hub
  ghi

  node

  # for grunt-webfont
  fontforge
  ttfautohint

  # to create favicons
  icoutils

  # ruby
  # python
  #sudo easy_install pip ?

  php55
  mysql
  php55-http

  # phantomjs
  # casperjs
  # slimerjs

  # youtube-dl
  # sub2srt
)

for pkg in $PACKAGES; do
  brewinstall $pkg
done

# mysql auto start
if ! ls $HOME/Library/LaunchAgents/homebrew.mxcl.mysql.plist > /dev/null
then
  ln -sfv /usr/local/opt/mysql/*.plist $HOME/Library/LaunchAgents
  launchctl load $HOME/Library/LaunchAgents/homebrew.mxcl.mysql.plist
fi

# ddclient human configuration & auto start
if ! ls /Library/LaunchDaemons/homebrew.mxcl.ddclient.plist > /dev/null
then
  sudo cp $DIR_DOTFILES/backpack/usr/local/etc/ddclient/ddclient.conf /usr/local/etc/ddclient
  subl -w /usr/local/etc/ddclient/ddclient.conf
  sudo cp -fv /usr/local/opt/ddclient/*.plist /Library/LaunchDaemons
  sudo launchctl load /Library/LaunchDaemons/homebrew.mxcl.ddclient.plist
fi
