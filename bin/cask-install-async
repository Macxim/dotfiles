#!/usr/bin/env node

if (process.argv.length < 1) {
	console.error('Usage: cask-install-async [apps]')
	process.exit(1)
}

var spawn = require('child_process').spawn
	, args = process.argv.slice(2)
	, length = args.length
	, maxSimultaneous = 3
	, i = 0
	, installed = 0

function caskInstall() {
	if (installed < length && args[installed]) {
		//spawn 'brew cask install'
		var current = args[installed]
		installed++
		console.log('Running `brew cask install ' + current + '`')
		spawn('brew', ['cask', 'install', current], {
			stdio: 'inherit'
		}).on('close', function (code) {
			if (code !== 0) {
				console.log('brew cask install ' + current + ' process exited with code ' + code)
			}
			if (installed < length) {
				caskInstall()
			}
		})
	}
}

while(i++ < maxSimultaneous && installed < length) {
	caskInstall()
}